window.wp=window.wp||{},function(e){const t=wp.themes=wp.themes||{};t.data=_wpThemeSettings;const s=t.data.pluginl10n||t.data.l10n;t.isInstall=!!t.data.settings.isInstall,_.extend(t,{model:{},view:{},routes:{},router:{},template:wp.template}),t.Model=Backbone.Model.extend({initialize(){let e;-1!==_.indexOf(t.data.installedThemes,this.get("slug"))&&this.set({installed:!0}),this.set({id:this.get("slug")||this.get("id")}),this.has("sections")&&(e=this.get("sections").description,this.set({description:e}))}}),t.view.Appearance=wp.Backbone.View.extend({el:"#wpbody-content .wrap",window:e(window),page:0,events:{"click .filter-links li > a":"search_category"},search_category(s){s.preventDefault();const i={};e(".filter-links li > a",this.el).removeClass("current"),e(s.target).addClass("current"),s.target.value=e(s.target).data("category"),this.collection.doSearch(s.target.value,!0),e(".wp-filter-search").val(s.target.value),this.searching&&13!==s.which?i.replace=!0:this.searching=!0,s.target.value?t.router.navigate(t.router.baseUrl(t.router.searchPath+s.target.value),i):t.router.navigate(t.router.baseUrl(""))},initialize(e){_.bindAll(this,"scroller"),this.SearchView=e.SearchView?e.SearchView:t.view.Search,this.window.bind("scroll",_.throttle(this.scroller,300))},render(){this.view=new t.view.Themes({collection:this.collection,parent:this}),this.search(),this.view.render(),this.$el.find(".theme-browser").empty().append(this.view.el).addClass("rendered")},searchContainer:e(".wrap h1:first"),search(){if(1===t.data.themes.length)return;const i=new this.SearchView({collection:this.collection,parent:this});i.render(),this.searchContainer.append(e.parseHTML('<label class="screen-reader-text" for="wp-filter-search-input">'+s.search+"</label>")).append(i.el)},scroller(){let e;const t=this.window.scrollTop()+this.window.height();e=this.$el.offsetTop+this.$el.outerHeight(!1)-this.window.height(),e=Math.round(.9*e),t>e&&this.trigger("theme:scroll")}}),t.Collection=Backbone.Collection.extend({model:t.Model,terms:"",doSearch(s){this.terms!==s&&(this.terms=s,this.terms.length>0&&this.search(this.terms),""===this.terms&&(this.reset(t.data.themes),e("body").removeClass("no-results")),this.trigger("themes:update"))},search(s,i=!1){let r,a,l,n,o;this.reset(t.data.themes,{silent:!0}),s=(s=s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")).replace(/ /g,")(?=.*");const c=new RegExp("^(?=.*"+s+").+","i"),h=this.filter((function(e){if("active"===s)return!0===e.attributes.active;if("inactive"===s)return!1===e.attributes.active;a=e.get("name").replace(/(<([^>]+)>)/gi,""),l=e.get("description").replace(/(<([^>]+)>)/gi,""),n=e.get("author").replace(/(<([^>]+)>)/gi,""),o=e.get("tags").split(","),_.each(o,(function(e,t){o[t]=e.trim()}));const t=_.contains(o,s);return r=_.union([a,e.get("id"),l,n]),c.test(e.get("author"))&&s.length>2&&e.set("displayAuthor",!0),c.test(r)||t}));0===h.length?this.trigger("query:empty"):e("body").removeClass("no-results"),this.reset(h)},paginate(e){let t=this;return e=e||0,t=_(t.rest(9999*e)),t=_(t.first(9999)),t},count:!1,query(t){const s=this.queries,i=this;let r;this.currentQuery.request=t,query=_.find(s,(function(e){return _.isEqual(e.request,t)}));const a=_.has(t,"page");if(a||(this.currentQuery.page=1),query||a){if(a)return this.apiCall(t,a).done((function(e){i.add(e.themes),i.trigger("query:success"),i.loadingThemes=!1})).fail((function(){i.trigger("query:fail")}));0===query.themes.length?i.trigger("query:empty"):e("body").removeClass("no-results"),_.isNumber(query.total)&&(this.count=query.total),this.reset(query.themes),query.total||(this.count=this.length),this.trigger("themes:update"),this.trigger("query:success",this.count)}else query=this.apiCall(t).done((function(e){e.themes&&(i.reset(e.themes),r=e.info.results,s.push({themes:e.themes,request:t,total:r})),i.trigger("themes:update"),i.trigger("query:success",r),e.themes&&0===e.themes.length&&i.trigger("query:empty")})).fail((function(){i.trigger("query:fail")}))},queries:[],currentQuery:{page:1,request:{}},apiCall:(t,s)=>wp.ajax.send("query-themes",{data:{request:_.extend({per_page:100,fields:{description:!0,tested:!0,requires:!0,rating:!0,downloaded:!0,downloadLink:!0,last_updated:!0,homepage:!0,num_ratings:!0}},t)},beforeSend(){s||e("body").addClass("loading-content").removeClass("no-results")}}),loadingThemes:!1}),t.view.Theme=wp.Backbone.View.extend({className:wu_ptm.display_type,state:"grid",html:t.template("theme"),events:{click:t.isInstall?"preview":"expand",keydown:t.isInstall?"preview":"expand",touchend:t.isInstall?"preview":"expand",keyup:"addFocus",touchmove:"preventExpand","click .theme-install":"installTheme","click .update-message":"updateTheme","click .theme-filter":"onFilter","click .drawer-toggle":"moreFilters","click .filter-drawer .apply-filters":"applyFilters",'click .filter-group [type="checkbox"]':"addFilter","click .filter-drawer .clear-filters":"clearFilters","click .edit-filters":"backToFilters"},touchDrag:!1,initialize(){this.model.on("change",this.render,this)},render(){const e=this.model.toJSON();this.$el.html(this.html(e)).attr({tabindex:0,"aria-describedby":e.id+"-action "+e.id+"-name","data-slug":e.id}),this.activeTheme(),this.model.get("displayAuthor")&&this.$el.addClass("display-author")},activeTheme(){this.model.get("active")&&this.$el.addClass("active")},addFocus(){const t=e(":focus").hasClass("theme")?e(":focus"):e(":focus").parents(".theme");e(".theme.focus").removeClass("focus"),t.addClass("focus")},expand(s){if("keydown"!==(s=s||window.event).type||13===s.which||32===s.which)return!0===this.touchDrag?this.touchDrag=!1:void(e(s.target).is(".theme-actions a")||e(s.target).is(".theme-actions a, .update-message, .button-link, .notice-dismiss")||(t.focusedTheme=this.$el,this.trigger("theme:expand",this.model.cid)))},preventExpand(){this.touchDrag=!0},preview(s){const i=this;let r;if(s=s||window.event,!0===this.touchDrag)return this.touchDrag=!1;if(e(s.target).not(".install-theme-preview").parents(".theme-actions").length)return;if("keydown"===s.type&&13!==s.which&&32!==s.which)return;if("keydown"===s.type&&13!==s.which&&e(":focus").hasClass("button"))return;s.preventDefault(),s=s||window.event,t.focusedTheme=this.$el;const a=new t.view.Preview({model:this.model});a.render(),this.setNavButtonsState(),1===this.model.collection.length?a.$el.addClass("no-navigation"):a.$el.removeClass("no-navigation"),e("div.wrap").append(a.el),this.listenTo(a,"theme:next",(function(){if(r=i.model,_.isUndefined(i.current)||(r=i.current),i.current=i.model.collection.at(i.model.collection.indexOf(r)+1),_.isUndefined(i.current))return i.options.parent.parent.trigger("theme:end"),i.current=r;a.model=i.current,a.render(),this.setNavButtonsState(),e(".next-theme").focus()})).listenTo(a,"theme:previous",(function(){r=i.model,0!==i.model.collection.indexOf(i.current)&&(_.isUndefined(i.current)||(r=i.current),i.current=i.model.collection.at(i.model.collection.indexOf(r)-1),_.isUndefined(i.current)||(a.model=i.current,a.render(),this.setNavButtonsState(),e(".previous-theme").focus()))})),this.listenTo(a,"preview:close",(function(){i.current=i.model}))},setNavButtonsState(){const t=e(".theme-install-overlay"),s=_.isUndefined(this.current)?this.model:this.current;0===this.model.collection.indexOf(s)&&t.find(".previous-theme").addClass("disabled"),_.isUndefined(this.model.collection.at(this.model.collection.indexOf(s)+1))&&t.find(".next-theme").addClass("disabled")},installTheme(t){const s=this;t.preventDefault(),wp.updates.maybeRequestFilesystemCredentials(t),e(document).on("wp-theme-install-success",(function(e){s.model.get("id")===e.slug&&s.model.set({installed:!0})})),wp.updates.installTheme({slug:e(t.target).data("slug")})},updateTheme(t){const s=this;this.model.get("hasPackage")&&(t.preventDefault(),wp.updates.maybeRequestFilesystemCredentials(t),e(document).on("wp-theme-update-success",(function(e){s.model.off("change",s.render,s),s.model.get("id")===e.slug&&s.model.set({hasUpdate:!1,version:e.newVersion}),s.model.on("change",s.render,s)})),wp.updates.updateTheme({slug:e(t.target).parents("div.theme").first().data("slug")}))}}),t.view.Details=wp.Backbone.View.extend({className:"theme-overlay",events:{click:"collapse","click .delete-theme":"deleteTheme","click .left":"previousTheme","click .right":"nextTheme","click #update-theme":"updateTheme"},html:t.template("theme-single"),render(){if("theme"!==wu_ptm.display_type)return;if(void 0===this.model)return;const e=this.model.toJSON();this.$el.html(this.html(e)),this.$el.attr("data-slug",e.id),this.activeTheme(),this.navigation(),this.screenshotCheck(this.$el),this.containFocus(this.$el)},activeTheme(){this.$el.toggleClass("active",this.model.get("active"))},containFocus(t){_.delay((function(){e(".theme-wrap a.button-primary:visible").focus()}),100),t.on("keydown.wp-themes",(function(e){const s=t.find(".theme-header button:not(.disabled)").first(),i=t.find(".theme-actions a:visible").last();9===e.which&&(s[0]===e.target&&e.shiftKey?(i.focus(),e.preventDefault()):i[0]!==e.target||e.shiftKey||(s.focus(),e.preventDefault()))}))},collapse(s){const i=this;let r;s=s||window.event,1!==t.data.themes.length&&(e(s.target).is(".theme-backdrop")||e(s.target).is(".close")||27===s.keyCode)&&(e("body").addClass("closing-overlay"),this.$el.fadeOut(130,(function(){e("body").removeClass("closing-overlay"),i.closeOverlay(),r=document.body.scrollTop,t.router.navigate(t.router.baseUrl("")),document.body.scrollTop=r,t.focusedTheme&&t.focusedTheme.focus()})))},navigation(){this.model.cid===this.model.collection.at(0).cid&&this.$el.find(".left").addClass("disabled").prop("disabled",!0),this.model.cid===this.model.collection.at(this.model.collection.length-1).cid&&this.$el.find(".right").addClass("disabled").prop("disabled",!0)},closeOverlay(){e("body").removeClass("modal-open"),this.remove(),this.unbind(),this.trigger("theme:collapse")},updateTheme(t){const s=this;t.preventDefault(),wp.updates.maybeRequestFilesystemCredentials(t),e(document).on("wp-theme-update-success",(function(e){s.model.get("id")===e.slug&&s.model.set({hasUpdate:!1,version:e.newVersion}),s.render()})),wp.updates.updateTheme({slug:e(t.target).data("slug")})},deleteTheme(s){const i=this,r=i.model.collection,a=t;s.preventDefault(),window.confirm(wp.themes.data.settings.confirmDelete)&&(wp.updates.maybeRequestFilesystemCredentials(s),e(document).one("wp-theme-delete-success",(function(t){i.$el.find(".close").trigger("click"),e('[data-slug="'+t.slug+'"]').css({backgroundColor:"#faafaa"}).fadeOut(350,(function(){e(this).remove(),a.data.themes=_.without(a.data.themes,_.findWhere(a.data.themes,{id:t.slug})),e(".wp-filter-search").val(""),r.doSearch(""),r.remove(i.model),r.trigger("themes:update")}))})),wp.updates.deleteTheme({slug:this.model.get("id")}))},nextTheme(){return this.trigger("theme:next",this.model.cid),!1},previousTheme(){return this.trigger("theme:previous",this.model.cid),!1},screenshotCheck(e){const t=e.find(".screenshot img"),s=new Image;s.src=t.attr("src"),s.width&&s.width<=300&&e.addClass("small-screenshot")}}),t.view.Preview=t.view.Details.extend({className:"wp-full-overlay expanded",el:".theme-install-overlay",events:{"click .close-full-overlay":"close","click .collapse-sidebar":"collapse","click .devices button":"previewDevice","click .previous-theme":"previousTheme","click .next-theme":"nextTheme",keyup:"keyEvent","click .theme-install":"installTheme"},html:t.template("theme-preview"),render(){const s=this,i=this.model.toJSON(),r=e(document.body);r.attr("aria-busy","true"),this.$el.removeClass("iframe-ready").html(this.html(i));const a=this.$el.data("current-preview-device");a&&s.tooglePreviewDeviceButtons(a),t.router.navigate(t.router.baseUrl(t.router.themePath+this.model.get("id")),{replace:!0}),this.$el.fadeIn(200,(function(){r.addClass("theme-installer-active full-overlay-active")})),this.$el.find("iframe").one("load",(function(){s.iframeLoaded()}))},iframeLoaded(){this.$el.addClass("iframe-ready"),e(document.body).attr("aria-busy","false")},close(){return this.$el.fadeOut(200,(function(){e("body").removeClass("theme-installer-active full-overlay-active"),t.focusedTheme&&t.focusedTheme.focus()})).removeClass("iframe-ready"),t.router.navigate(t.router.baseUrl("")),this.trigger("preview:close"),this.undelegateEvents(),this.unbind(),!1},collapse(t){const i=e(t.currentTarget);return"true"===i.attr("aria-expanded")?i.attr({"aria-expanded":"false","aria-label":s.expandSidebar}):i.attr({"aria-expanded":"true","aria-label":s.collapseSidebar}),this.$el.toggleClass("collapsed").toggleClass("expanded"),!1},previewDevice(t){const s=e(t.currentTarget).data("device");this.$el.removeClass("preview-desktop preview-tablet preview-mobile").addClass("preview-"+s).data("current-preview-device",s),this.tooglePreviewDeviceButtons(s)},tooglePreviewDeviceButtons(t){const s=e(".wp-full-overlay-footer .devices");s.find("button").removeClass("active").attr("aria-pressed",!1),s.find("button.preview-"+t).addClass("active").attr("aria-pressed",!0)},keyEvent(e){27===e.keyCode&&(this.undelegateEvents(),this.close()),39===e.keyCode&&_.once(this.nextTheme()),37===e.keyCode&&this.previousTheme()},installTheme(t){const s=this,i=e(t.target);t.preventDefault(),i.hasClass("disabled")||(wp.updates.maybeRequestFilesystemCredentials(t),e(document).on("wp-theme-install-success",(function(){s.model.set({installed:!0})})),wp.updates.installTheme({slug:i.data("slug")}))}}),t.view.Themes=wp.Backbone.View.extend({className:"themes wp-clearfix",$overlay:e("div.theme-overlay"),index:0,count:e(".wrap .theme-count"),liveThemeCount:0,initialize(t){const s=this;this.parent=t.parent,this.setView("grid"),s.currentTheme(),this.listenTo(s.collection,"themes:update",(function(){s.parent.page=0,s.currentTheme(),s.render(this)})),this.listenTo(s.collection,"query:success",(function(e){_.isNumber(e)?(s.count.text(e),s.announceSearchResults(e)):(s.count.text(s.collection.length),s.announceSearchResults(s.collection.length))})),this.listenTo(s.collection,"query:empty",(function(){e("body").addClass("no-results")})),this.listenTo(this.parent,"theme:scroll",(function(){s.renderThemes(s.parent.page)})),this.listenTo(this.parent,"theme:close",(function(){s.overlay&&s.overlay.closeOverlay()})),e("body").on("keyup",(function(t){s.overlay&&(e("#request-filesystem-credentials-dialog").is(":visible")||(39===t.keyCode&&s.overlay.nextTheme(),37===t.keyCode&&s.overlay.previousTheme(),27===t.keyCode&&s.overlay.collapse(t)))}))},render(){this.$el.empty(),1===t.data.themes.length&&"themes"===wu_ptm.type&&(this.singleTheme=new t.view.Details({model:this.collection.models[0]}),this.singleTheme.render(),this.$el.addClass("single-theme"),this.$el.append(this.singleTheme.el)),this.options.collection.size()>0&&this.renderThemes(this.parent.page),this.liveThemeCount=this.collection.count?this.collection.count:this.collection.length,this.count.text(this.liveThemeCount),t.isInstall||this.announceSearchResults(this.liveThemeCount)},renderThemes(i){const r=this;r.instance=r.collection.paginate(i),0!==r.instance.size()?(!t.isInstall&&i>=1&&e(".add-new-theme").remove(),r.instance.each((function(e){r.theme=new t.view.Theme({model:e,parent:r}),r.theme.render(),r.$el.append(r.theme.el),r.listenTo(r.theme,"theme:expand",r.expand,r)})),!t.isInstall&&t.data.settings.canInstall&&this.$el.append('<div class="theme add-new-theme"><a href="'+t.data.settings.installURI+'"><div class="theme-screenshot"><span></span></div><h2 class="theme-name">'+s.addNew+"</h2></a></div>"),this.parent.page++):this.parent.trigger("theme:end")},currentTheme(){const e=this,t=e.collection.findWhere({active:!0});t&&(e.collection.remove(t),e.collection.add(t,{at:0}))},setView:e=>e,expand(s){if("theme"!==wu_ptm.display_type)return;const i=this;let r,a;this.model=i.collection.get(s),t.router.navigate(t.router.baseUrl(t.router.themePath+this.model.id)),this.setView("detail"),e("body").addClass("modal-open"),this.overlay=new t.view.Details({model:i.model}),this.overlay.render(),this.model.get("hasUpdate")&&(r=e('[data-slug="'+this.model.id+'"]'),a=e(this.overlay.el),r.find(".updating-message").length?(a.find(".notice-warning h3").remove(),a.find(".notice-warning").removeClass("notice-large").addClass("updating-message").find("p").text(wp.updates.l10n.updating)):r.find(".notice-error").length&&a.find(".notice-warning").remove()),this.$overlay.html(this.overlay.el),this.listenTo(this.overlay,"theme:next",(function(){i.next([i.model.cid])})).listenTo(this.overlay,"theme:previous",(function(){i.previous([i.model.cid])}))},next(e){const t=this,s=t.collection.get(e[0]),i=t.collection.at(t.collection.indexOf(s)+1);void 0!==i&&(this.overlay.closeOverlay(),t.theme.trigger("theme:expand",i.cid))},previous(e){const t=this,s=t.collection.get(e[0]),i=t.collection.at(t.collection.indexOf(s)-1);void 0!==i&&(this.overlay.closeOverlay(),t.theme.trigger("theme:expand",i.cid))},announceSearchResults(e){0===e?wp.a11y.speak(s.noThemesFound):wp.a11y.speak(s.themesFound.replace("%d",e))}}),t.view.Search=wp.Backbone.View.extend({tagName:"input",className:"wp-filter-search",id:"wp-filter-search-input",searching:!1,attributes:{placeholder:s.searchPlaceholder,type:"search","aria-describedby":"live-search-desc"},events:{input:"search",keyup:"search",blur:"pushState"},initialize(e){this.parent=e.parent,this.listenTo(this.parent,"theme:close",(function(){this.searching=!1}))},search(e){"keyup"===e.type&&27===e.which&&(e.target.value=""),this.doSearch(e)},doSearch:_.debounce((function(e){const s={};this.collection.doSearch(e.target.value),this.searching&&13!==e.which?s.replace=!0:this.searching=!0,e.target.value?t.router.navigate(t.router.baseUrl(t.router.searchPath+e.target.value),s):t.router.navigate(t.router.baseUrl(""))}),500),pushState(e){let s=t.router.baseUrl("");e.target.value&&(s=t.router.baseUrl(t.router.searchPath+e.target.value)),this.searching=!1,t.router.navigate(s)}});t.Router=Backbone.Router.extend({routes:function(){const e={};return e[wu_ptm.type+".php?"+wu_ptm.type.replace("s","")+"=:slug"]="theme",e[wu_ptm.type+".php?search=:query"]="search",e[wu_ptm.type+".php?s=:query"]="search",e[wu_ptm.type+".php"]="themes",e[""]="themes",e}(),baseUrl:e=>wu_ptm.type+".php"+e,themePath:"?"+wu_ptm.type.replace("s","")+"=",searchPath:"?search=",search(t){e(".wp-filter-search").val(t),e(".filter-links li > a").removeClass("current");const s=e('[data-category="'+t+'"]');s.length?s.addClass("current"):e('[data-category=""]').addClass("current")},themes(){e(".wp-filter-search").val("")},navigate(){Backbone.history._hasPushState&&Backbone.Router.prototype.navigate.apply(this,arguments)}}),t.Run={init(){this.themes=new t.Collection(t.data.themes),this.view=new t.view.Appearance({collection:this.themes}),this.render()},render(){this.view.render(),this.routes(),Backbone.history.start({root:t.data.settings.adminUrl,pushState:!0,hashChange:!1})},routes(){const s=this;t.router=new t.Router,t.router.on("route:theme",(function(e){s.view.view.expand(e)})),t.router.on("route:themes",(function(){s.themes.doSearch(""),s.view.trigger("theme:close")})),t.router.on("route:search",(function(){e(".wp-filter-search").trigger("keyup")})),this.extraRoutes()},extraRoutes:()=>!1},t.view.InstallerSearch=t.view.Search.extend({events:{input:"search",keyup:"search"},terms:"",search(e){("keyup"!==e.type||9!==e.which&&16!==e.which)&&(this.collection=this.options.parent.view.collection,"keyup"===e.type&&27===e.which&&(e.target.value=""),this.doSearch(e.target.value))},doSearch:_.debounce((function(s){const i={};this.terms!==s&&(this.terms=s,i.search=s,"author:"===s.substring(0,7)&&(i.search="",i.author=s.slice(7)),"tag:"===s.substring(0,4)&&(i.search="",i.tag=[s.slice(4)]),e(".filter-links li > a.current").removeClass("current"),e("body").removeClass("show-filters filters-applied show-favorites-form"),e(".drawer-toggle").attr("aria-expanded","false"),this.collection.query(i),t.router.navigate(t.router.baseUrl(t.router.searchPath+s),{replace:!0}))}),500)}),t.view.Installer=t.view.Appearance.extend({el:"#wpbody-content .wrap",events:{"click .filter-links li > a":"onSort","click .theme-filter":"onFilter","click .drawer-toggle":"moreFilters","click .filter-drawer .apply-filters":"applyFilters",'click .filter-group [type="checkbox"]':"addFilter","click .filter-drawer .clear-filters":"clearFilters","click .edit-filters":"backToFilters","click .favorites-form-submit":"saveUsername","keyup #wporg-username-input":"saveUsername"},render(){const i=this;this.search(),this.uploader(),this.collection=new t.Collection,this.listenTo(this,"theme:end",(function(){i.collection.loadingThemes||(i.collection.loadingThemes=!0,i.collection.currentQuery.page++,_.extend(i.collection.currentQuery.request,{page:i.collection.currentQuery.page}),i.collection.query(i.collection.currentQuery.request))})),this.listenTo(this.collection,"query:success",(function(){e("body").removeClass("loading-content"),e(".theme-browser").find("div.error").remove()})),this.listenTo(this.collection,"query:fail",(function(){e("body").removeClass("loading-content"),e(".theme-browser").find("div.error").remove(),e(".theme-browser").find("div.themes").before('<div class="error"><p>'+s.error+"</p></div>")})),this.view&&this.view.remove(),this.view=new t.view.Themes({collection:this.collection,parent:this}),this.page=0,this.$el.find(".themes").remove(),this.view.render(),this.$el.find(".theme-browser").append(this.view.el).addClass("rendered")},browse(e){this.collection.query({browse:e})},onSort(s){s.preventDefault();const i=e(s.target);if(e("body").removeClass("filters-applied show-filters"),e(".drawer-toggle").attr("aria-expanded","false"),i.hasClass(this.activeClass))return;const r=i.data("sort");this.sort(r),t.router.navigate(t.router.baseUrl(t.router.browsePath+r))},sort(t){this.clearSearch(),e(".filter-links li > a, .theme-filter").removeClass(this.activeClass),e('[data-sort="'+t+'"]').addClass(this.activeClass),"favorites"===t?e("body").addClass("show-favorites-form"):e("body").removeClass("show-favorites-form"),this.browse(t)},onFilter(t){const s=e(t.target);let i;if(i=s.data("filter"),s.hasClass(this.activeClass))return;if(e(".filter-links li > a, .theme-section").removeClass(this.activeClass),s.addClass(this.activeClass),!i)return;i=_.union([i,this.filtersChecked()]);const r={tag:[i]};this.collection.query(r)},addFilter(){this.filtersChecked()},applyFilters(t){let i;t&&t.preventDefault();const r={tag:a},a=this.filtersChecked();if(!a)return void wp.a11y.speak(s.selectFeatureFilter);e("body").addClass("filters-applied"),e(".filter-links li > a.current").removeClass("current");const l=e(".filtered-by .tags");l.empty(),_.each(a,(function(t){i=e('label[for="filter-id-'+t+'"]').text(),l.append('<span class="tag">'+i+"</span>")})),this.collection.query(r)},saveUsername(t){if(t&&t.preventDefault(),"keyup"===t.type&&13!==t.which)return;const s=e("#wporg-username-input").val(),i={browse:"favorites",user:s},r=this,a=e("#wporg-username-nonce").val();return wp.ajax.send("save-wporg-username",{data:{_wpnonce:a,username:s},success(){r.collection.query(i)}})},filtersChecked(){const t=e(".filter-group").find(":checkbox"),s=[];return _.each(t.filter(":checked"),(function(t){s.push(e(t).prop("value"))})),0===s.length?(e(".filter-drawer .apply-filters").find("span").text(""),e(".filter-drawer .clear-filters").hide(),e("body").removeClass("filters-applied"),!1):(e(".filter-drawer .apply-filters").find("span").text(s.length),e(".filter-drawer .clear-filters").css("display","inline-block"),s)},activeClass:"current",searchContainer:e(".wp-filter .search-form"),uploader(){const t=e(".upload-view-toggle"),s=e(document.body);t.on("click",(function(){s.toggleClass("show-upload-view"),t.attr("aria-expanded",s.hasClass("show-upload-view"))}))},moreFilters(s){s.preventDefault();const i=e("body");if(i.hasClass("filters-applied"))return this.backToFilters();this.clearSearch(),t.router.navigate(t.router.baseUrl("")),i.toggleClass("show-filters"),e(".drawer-toggle").attr("aria-expanded",i.hasClass("show-filters"))},clearFilters(t){const s=e(".filter-group").find(":checkbox"),i=this;t.preventDefault(),_.each(s.filter(":checked"),(function(t){return e(t).prop("checked",!1),i.filtersChecked()}))},backToFilters(t){t&&t.preventDefault(),e("body").removeClass("filters-applied")},clearSearch(){e("#wp-filter-search-input").val("")}}),t.InstallerRouter=Backbone.Router.extend({routes:{"theme-install.php?theme=:slug":"preview","theme-install.php?browse=:sort":"sort","theme-install.php?search=:query":"search","theme-install.php":"sort"},baseUrl:e=>"theme-install.php"+e,themePath:"?theme=",browsePath:"?browse=",searchPath:"?search=",search(t){e(".wp-filter-search").val(t)},navigate(){Backbone.history._hasPushState&&Backbone.Router.prototype.navigate.apply(this,arguments)}}),t.RunInstaller={init(){this.view=new t.view.Installer({section:"featured",SearchView:t.view.InstallerSearch}),this.render()},render(){this.view.render(),this.routes(),Backbone.history.start({root:t.data.settings.adminUrl,pushState:!0,hashChange:!1})},routes(){const s=this,i={};t.router=new t.InstallerRouter,t.router.on("route:preview",(function(e){i.theme=e,s.view.collection.query(i),s.view.collection.once("update",(function(){s.view.view.theme.preview()}))})),t.router.on("route:sort",(function(e){e||(e="featured"),s.view.sort(e),s.view.trigger("theme:close")})),t.router.on("route:search",(function(){e(".wp-filter-search").focus().trigger("keyup")})),this.extraRoutes()},extraRoutes:()=>!1},e(document).ready((function(){t.isInstall?t.RunInstaller.init():t.Run.init(),e(".broken-themes .delete-theme").on("click",(function(){return confirm(_wpThemeSettings.settings.confirmDelete)}))}))}(jQuery),jQuery(document).ready((function(e){tb_position=function(){const t=e("#TB_window"),s=e(window).width(),i=e(window).height(),r=1040<s?1040:s;let a=0;e("#wpadminbar").length&&(a=parseInt(e("#wpadminbar").css("height"),10)),t.size()&&(t.width(r-50).height(i-45-a),e("#TB_iframeContent").width(r-50).height(i-75-a),t.css({"margin-left":"-"+parseInt((r-50)/2,10)+"px"}),void 0!==document.body.style.maxWidth&&t.css({top:20+a+"px","margin-top":"0"}))},e(window).resize((function(){tb_position()}))}));